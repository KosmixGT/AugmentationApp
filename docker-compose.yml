version: '3.4'

services:

  backend:
    build: ./server
    environment:
        - SECRET_KEY=mysecretkey
        - ALGORITHM=HS256
        - ACCESS_TOKEN_EXPIRES_MINUTES=60
        - DATABASE_URL=
    ports:
      - 5000:5000
    volumes:
      - ./server/app:/app
    command: uvicorn main:app --reload --host 0.0.0.0 --port 5000

  frontend:
    build: ./client
    environment:
    - VUE_APP_BACKEND_URL=http://localhost:5000
    volumes:
      - './client:/app'
      - '/app/node_modules'
    ports:
      - 8080:8080
  
  prometheus:
  image: prom/prometheus
  container_name: prometheus
  ports:
    - 9090:9090
  volumes:
    - ./prometheus_data/prometheus.yml:/etc/prometheus/prometheus.yml
  command:
    - '--config.file=/etc/prometheus/prometheus.yml'

  grafana:
    image: grafana/grafana
    container_name: grafana
    ports:
      - 3000:3000
    volumes:
      - grafana_data:/var/lib/grafana
  
volumes:
  prometheus_data:
    driver: local
    driver_opts:
      o: bind
      type: none
      device: ./prometheus_data
  grafana_data:
    driver: local
    driver_opts:
      o: bind
      type: none
      device: ./grafana_data
